        <!-- Page Content -->
            <div id="page-wrapper">
                <div class="container-fluid">

             
                    <div class="row">
                        
                        <div class="col-lg-12" >
                            
                            <h3 class="page-header" style="box-shadow: 0px 1px #888888; border-bottom: thin solid lightgrey;">MoH Diagonistic Report</h3>
                        </div>                       
                    </div>
                    <div class="row">
                        <div class="col-lg-12">
                            <div id="head" style="height:4px; background: lightgrey; width: 0%"></div>
                        </div>
                    </div>
                    <div style="margin-top: -5px; border: thin solid lightgrey; box-shadow: 1px 1px 1px 1px #888888;">
                        <div class="panel" style="margin-top: 0px;">                       
                            <div class="panel-body">
                                        <span>
                                            <label>Level</label>
                                            <select name="level" id="level">
                                                <option value="national" onclick="document.getElementById('lab_facility').style.display ='none';">National Level</option>
                                                <option value="facility" onclick="document.getElementById('lab_facility').style.display ='inline';">Facility Level</option>
                                            </select>
                                        
                                        </span>
                                        <span id="lab_facility" style="margin-left: 10px; display: none;">
                                            <label>Lab</label>
                                            <select name="facility" id="facility">
                                                <option value="Kamuzu Central Hospital">Kamuzu Central Hospital Lab</option>
                                                <option value="Queen Elizabeth Central Hospital">Queens Elizabeth Hospital Lab</option>
                                                <option value="Thyolo District Hospital">Thyolo District Hospital Lab</option>
                                                <option value="Zomba Central Hospital">Zomba Central Hospital Lab</option>
                                                <option value="Mzuzu Central Hospital">Mzuzu Central Hospital Lab</option>
                                            </select>
                                        </span>
                                        <span style="margin-left: 10px;">
                                            <label>Lab Department</label>
                                            <select name="department" id="department">
                                                <option value="all">All Departments</option>
                                                <option value="Microbiology">Microbiology</option>
                                                <option value="Haematology">Haematology</option>
                                                <option value="Serology">Serology</option>
                                                <option value="Blood_Bank">Blood Bank</option>
                                                <option value="Biochemistry">Biochemistry</option>
                                                <option value="Parasitology">Parasitology</option>
                                            </select>
                                        </span>
                                        <span style="margin-left: 10px;">
                                            <label>Year</label>
                                            <select name="year" id="year">
                                                <option value="2018">2018</option>
                                                <option value="2017">2017</option>
                                                <option value="2016">2016</option>
                                            </select>
                                        </span>
                                        <span style="margin-left: 10px;">
                                            <label>Quarter</label>
                                            <select name="quarter" id="quarter">
                                                <option value="q1">Q1</option>
                                                <option value="q2">Q2</option>
                                                <option value="q3">Q3</option>
                                                <option value="q4">Q4</option>
                                            </select>
                                        </span>
                                        <span style="margin-left: 10px;">
                                            <input  class="btn btn-primary" type="button" value="Search" onclick="loadData();">
                                        </span>

                                        <span style="margin-left: 10px;">
                                            <input id ="export" style="display:none;" type="button" value="Export" class="btn btn-success" onclick="create_csv();">
                                        </span>

                            </div>
                        </div>  
                    

                        <!-- table -->

                        <div style=" margin-top: 1px; height: 650px; overflow: scroll; border-top: thin solid lightgrey;" id="table_data">
                            <table class="table" id="table">
                                <thead>
                                    <tr id="t_header">
                                        <th>Indicator</th>
                            
                                    </tr>
                                </thead>
                                <tbody id="rows">
                                        <tr id="disp_row">
                                            <td colspan="5">
                                                <span style="color: red;"> search to view data </span>
                                            </td>
                                            
                                        </tr>						
                                </tbody>
                            </table>
                        </div>                    
                    </div>
                </div>   
            </div>
        </div>
    </body>



    <script type="text/javascript">

        var rows_counter = 0;
        var rows_header_counter = 0;
        var csv = [ ];
        var year = "";
        var table = document.getElementById("table");


        var indicators = {};

        indicators['Heamatology'] = [
            "Full Blood Count",
            "Erythrocyte Sedimentation Rate (ESR)",
            "Sickling Test",
            "Prothrombin time (PT)",
            "Activated Partial Thromboplastin Time (APTT)"
          
        ]

        indicators['Biochemistry'] = [
                        "Blood glucose",
						"CSF glucose",
						"Total Protein",
						"Albumin",
						"Alkaline Phosphatase(ALP)",
						"Alanine aminotransferase (ALT)",
						"Amylase",
						"Antistreptolysin O (ASO)",
						"Aspartate aminotransferase(AST)",
						"Bilirubin Total",
						"Bilirubin Direct",
						"Calcium",
						"Chloride",
						"Cholesterol Total",
						"Cholesterol LDL",
						"Cholesterol HDL",
						"Cholinesterase",
						"C Reactive Protein (CRP)",
						"Creatinine",
						"Creatine Kinase NAC",
						"Creatine Kinase MB",
						"Haemoglobin A1c",
						"Iron",
						"Lipase",
						"Lactate Dehydrogenase (LDH)",
						"Magnesium",
						"Micro-protein",
						"Micro-albumin",
						"Phosphorus",
						"Potassium",
						"Rheumatoid Factor",
						"Sodium",
						"Triglycerides",
						"Urea",
						"Uric acid"
        ]

        indicators['Blood Bank'] = [
            "blood grouping done on Patients","Total X-matched","X- matched for matenity",
            "X-macthed for peads","X-matched for others","X-matches done on patients with Hb ≤ 6.0g/dl",
            "X-matches done on patients with Hb > 6.0g/dl"
        ]

        indicators['Microbiology'] = [
                        "Number of AFB sputum examined",
						"Number of  new TB cases examined",
						"New cases with positive smear",
						"MTB Not Detected",
						"RIF Resistant Detected",
						"RIF Resistant Not Detected",
						"RIF Resistant Indeterminate",
						"Invalid",
						"No results",
						"Number of CSF samples analysed",
						"Number of CSF samples analysed for AFB",
						"Number of CSF samples with Organism",
						"HVS analysed",
						"Number of Blood Cultures done",
						"Positive blood Cultures",
						"Number of tests on microscopy",
						"Number of tests on GeneXpert",
						"MTB Detected",
						"India ink positive",
						"Gram stain positive",

        ]

        indicators['Parasitology'] = [
            "Total malaria microscopy tests done","Malaria microscopy in ≤ 5yrs (by species)?","Positive malaria slides in < 5yrs",
            "Malaria microscopy in unknown age","Positive malaria slides in unknown age","Total MRDTs Done",
            "MRDTs Positives","MRDTs in ≤  5yrs","MRDT Positives in < 5yrs",
            "MRDTs in >= 5yrs'","MRDT Positives in > 5yrs'", "Total invalid MRDTs tests']",
            "Trypanosome tests","Positive tests","Urine microscopy total","Schistosome Haematobium",
            "Other urine parasites","urine chemistry (count)","Semen analysis (count)",
            "Blood Parasites (count)","Blood Parasites seen","Stool Microscopy (count)",
            "Stool Microscopy Parasites seen"
        ]
                        

        indicators['Serology'] = [
            "Syphilis Test",
            "Syphilis screening on patients (by depart_option)",
            "Positive tests^",
            "Syphilis screening on antenatal mothers",
            "Positive tests ^",
            "HepBs test done on patients",
            "Positive_tests  ^",
            "HepC test done on patients",
            "Positive tests  ^",
            "Hcg  Pregnacy tests done",
            "Positive tests   ^",
            "HIV tests on PEP",
            "positives tests    ^",
        ]

        function loadData() {

            var quarter = document.getElementById("quarter").value;
            var department = document.getElementById("department").value;
            var facility = document.getElementById("facility").value;
            var level = document.getElementById("level").value;
            year = document.getElementById("year").value;
            var mainHeader = document.getElementById("t_header");
            var rows = document.getElementById("rows");
            var status = document.getElementById("status");
            var dis_row = document.getElementById("disp_row");
            var table = document.getElementById("table");



            var headerData = document.createElement("th");

            if (quarter == "q1")
            {   
                var cellCount = mainHeader.cells.length;
                
                if (cellCount == 5)
                {
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                
                }
                else if (cellCount > 5)
                {
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                }
                    mainHeader.insertCell(1).innerHTML = "Total".bold();
                    mainHeader.insertCell(1).innerHTML = "March".bold();
                    mainHeader.insertCell(1).innerHTML = "Feb".bold();
                    mainHeader.insertCell(1).innerHTML = "Jan".bold();
                

            } 
            else if (quarter == "q2")
            {
                var cellCount = mainHeader.cells.length;
                if (cellCount == 5)
                {
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                
                }else if (cellCount > 5)
                {
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                }

                mainHeader.insertCell(1).innerHTML = "Total".bold();
                mainHeader.insertCell(1).innerHTML = "Jun".bold();
                mainHeader.insertCell(1).innerHTML = "May".bold();
                mainHeader.insertCell(1).innerHTML = "Apr".bold();
                
            }
            else if (quarter == "q3")
            {	
                var cellCount = mainHeader.cells.length;
                if (cellCount == 5)
                {
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);			
                }else if (cellCount > 5)
                {
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                }

                mainHeader.insertCell(1).innerHTML = "Total".bold();
                mainHeader.insertCell(1).innerHTML = "Sep".bold();
                mainHeader.insertCell(1).innerHTML = "Aug".bold();
                mainHeader.insertCell(1).innerHTML = "Jul".bold();
            }
            else if (quarter == "q4")
            {	
                var cellCount = mainHeader.cells.length;
                if (cellCount == 5)
                {
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);			
                }else if (cellCount > 5)
                {
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                }

                mainHeader.insertCell(1).innerHTML = "Total".bold();
                mainHeader.insertCell(1).innerHTML = "Dec".bold();
                mainHeader.insertCell(1).innerHTML = "Nov".bold();
                mainHeader.insertCell(1).innerHTML = "Oct".bold();
            }
            else
            {
                var cellCount = mainHeader.cells.length;
                
                if (cellCount > 5)
                {
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);			
                }else if (cellCount ==5)
                {
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                    mainHeader.deleteCell(1);
                }

                mainHeader.insertCell(1).innerHTML = "Total"
                mainHeader.insertCell(1).innerHTML = "Dec"
                mainHeader.insertCell(1).innerHTML = "Nov"
                mainHeader.insertCell(1).innerHTML = "Oct"

                mainHeader.insertCell(1).innerHTML = "Total"
                mainHeader.insertCell(1).innerHTML = "Sep"
                mainHeader.insertCell(1).innerHTML = "Aug"
                mainHeader.insertCell(1).innerHTML = "Jul"

                mainHeader.insertCell(1).innerHTML = "Total"
                mainHeader.insertCell(1).innerHTML = "June"
                mainHeader.insertCell(1).innerHTML = "May"
                mainHeader.insertCell(1).innerHTML = "Apr"

                mainHeader.insertCell(1).innerHTML = "Total"
                mainHeader.insertCell(1).innerHTML = "March"
                mainHeader.insertCell(1).innerHTML = "Feb"
                mainHeader.insertCell(1).innerHTML = "Jan"
            }

            var header_counter = 0;
            var row_counter = 0;		
            var com_counter = 1;
            var counter = indicators["Microbiology"].length + indicators["Heamatology"].length + indicators["Serology"].length + indicators["Blood Bank"].length + indicators["Biochemistry"].length + indicators["Parasitology"].length;
            csv = [];

            if (rows_header_counter == 0){
                table.deleteRow(1);
            }
            else
            {	var v = rows_counter + rows_header_counter
                            
                for (var r = 1; r <= v; v = v - 1)
                { 
                    table.deleteRow(r);
                }
                rows_counter = 0;
                rows_header_counter = 0;
            }
        
            if (level == "national" && department == "all")
            {
                for (depart in indicators){
                   
                    var row = rows.insertRow(row_counter);
                    var cel = row.insertCell(0);						
                    cel.innerHTML = depart.toUpperCase().bold();
                    cel.style.color = "darkblue";
                    cel.style.background = "lightgrey";
                    cel.colSpan = "5";
                    indicator_values = indicators[depart];
                    csv[com_counter - 1] = [depart,"","","",""];
                   
                    var progress_bar = document.getElementById("head");
                    for (var i = 0; i < indicator_values.length; i++)
                    { 
                                               
                            var row = rows.insertRow(com_counter);
                            var cel = row.insertCell(0);
                            cel.innerHTML = indicator_values[i];

                            var cel = row.insertCell(1);
                            cel.innerHTML = "!";
                            cel.style.color = "red";
                            cel.id = com_counter +"one";

                            var cel = row.insertCell(2);
                            cel.innerHTML = "!";
                            cel.style.color = "red";
                            cel.id = com_counter +"two";

                            var cel = row.insertCell(3);
                            cel.innerHTML = "!";
                            cel.style.color = "red";
                            cel.id = com_counter +"three";

                            var cel = row.insertCell(4);
                            cel.innerHTML = "!";
                            cel.style.color = "red";
                            cel.id = com_counter +"four";

                        var url = '/report/retrieve_data_moh_report?year=' + year + "&indicator=" + indicator_values[i] + "&quarter=" + quarter;
                        jQuery.ajax({
                                    async: false,
                                    url: url,
                                    success: function(res){     
                                        var results = JSON.parse(res);
                                             
                                        document.getElementById(com_counter+"one").innerHTML = results[0];
                                        document.getElementById(com_counter+"one").style.color = "maroon";
                                        document.getElementById(com_counter+"two").innerHTML = results[1];
                                        document.getElementById(com_counter+"two").style.color = "maroon";
                                        document.getElementById(com_counter+"three").innerHTML = results[2];
                                        document.getElementById(com_counter+"three").style.color = "maroon";
                                        document.getElementById(com_counter+"four").innerHTML = results[0] + results[1] + results[2];
                                        document.getElementById(com_counter+"four").style.color = "maroon";
                                        csv[com_counter] = [indicator_values[i],results[0],results[1],results[2],parseInt(results[0]) + parseInt(results[1]) + parseInt(results[2])];
                                        com_counter = com_counter + 1;
                                        progress_bar.style.width = (((com_counter - 6)/counter)*100).toFixed(0) +"%";
                                        progress_bar.style.background = "green";   
                                    },	
                                    error: function(err){
                                        alert("bad");
                                    }
                        });  
                        rows_counter = rows_counter + 1;                     
                    }
                    if (progress_bar.style.width == "100%")
                        {
                            document.getElementById("export").style.display = "inline";
                        }
                    rows_header_counter = rows_header_counter + 1;
                    var department = depart;
                    row_counter = com_counter;                
                    com_counter = com_counter + 1;
                }
            }
            else if (level == "national" && department != "all")
            {
                    if (department == "Microbiology")
                    {
                            depart = "Microbiology"
                            var row = rows.insertRow(row_counter);
                            var cel = row.insertCell(0);						
                            cel.innerHTML = depart.toUpperCase().bold();
                            cel.style.color = "darkblue";
                            cel.style.background = "lightgrey";
                            cel.colSpan = "5";
                            indicator_values = indicators[depart];
                            csv[com_counter - 1] = [depart,"","","",""];
                            counter = indicators[depart].length;
                           
                            var progress_bar = document.getElementById("head");
                            for (var i = 0; i < indicator_values.length; i++)
                            { 
                                                       
                                    var row = rows.insertRow(com_counter);
                                    var cel = row.insertCell(0);
                                    cel.innerHTML = indicator_values[i];
        
                                    var cel = row.insertCell(1);
                                    cel.innerHTML = "!";
                                    cel.style.color = "red";
                                    cel.id = com_counter +"one";
        
                                    var cel = row.insertCell(2);
                                    cel.innerHTML = "!";
                                    cel.style.color = "red";
                                    cel.id = com_counter +"two";
        
                                    var cel = row.insertCell(3);
                                    cel.innerHTML = "!";
                                    cel.style.color = "red";
                                    cel.id = com_counter +"three";
        
                                    var cel = row.insertCell(4);
                                    cel.innerHTML = "!";
                                    cel.style.color = "red";
                                    cel.id = com_counter +"four";
        
                                var url = '/report/retrieve_data_moh_report?year=' + year + "&indicator=" + indicator_values[i] + "&quarter=" + quarter;
                                jQuery.ajax({
                                            async: false,
                                            url: url,
                                            success: function(res){     
                                                var results = JSON.parse(res);
                                                console.log(indicator_values[i]);
                                                document.getElementById(com_counter+"one").innerHTML = results[0];
                                                document.getElementById(com_counter+"one").style.color = "maroon";
                                                document.getElementById(com_counter+"two").innerHTML = results[1];
                                                document.getElementById(com_counter+"two").style.color = "maroon";
                                                document.getElementById(com_counter+"three").innerHTML = results[2];
                                                document.getElementById(com_counter+"three").style.color = "maroon";
                                                document.getElementById(com_counter+"four").innerHTML = results[0] + results[1] + results[2];
                                                document.getElementById(com_counter+"four").style.color = "maroon";
                                                csv[com_counter] = [indicator_values[i],results[0],results[1],results[2],parseInt(results[0]) + parseInt(results[1]) + parseInt(results[2])];
                                                com_counter = com_counter + 1;
                                                progress_bar.style.width = (((com_counter - 1)/counter)*100).toFixed(0) +"%";
                                                progress_bar.style.background = "green";   
                                            },	
                                            error: function(err){
                                                alert("bad");
                                            }
                                });  
                                rows_counter = rows_counter + 1;                     
                            }
                            if (progress_bar.style.width == "100%")
                                {
                                    document.getElementById("export").style.display = "inline";
                                }
                            rows_header_counter = rows_header_counter + 1;
                            var department = depart;
                            row_counter = com_counter;                
                            com_counter = com_counter + 1;
                          
                        
                    }
                    else if (department == "Haematology")
                    {
    
                    }
                    else if (department == "Serology")
                    {
                            depart = "Serology"
                            var row = rows.insertRow(row_counter);
                            var cel = row.insertCell(0);						
                            cel.innerHTML = depart.toUpperCase().bold();
                            cel.style.color = "darkblue";
                            cel.style.background = "lightgrey";
                            cel.colSpan = "5";
                            indicator_values = indicators[depart];
                            csv[com_counter - 1] = [depart,"","","",""];
                            counter = indicators[depart].length;
                           
                            var progress_bar = document.getElementById("head");
                            for (var i = 0; i < indicator_values.length; i++)
                            { 
                                                       
                                    var row = rows.insertRow(com_counter);
                                    var cel = row.insertCell(0);
                                    cel.innerHTML = indicator_values[i];
        
                                    var cel = row.insertCell(1);
                                    cel.innerHTML = "!";
                                    cel.style.color = "red";
                                    cel.id = com_counter +"one";
        
                                    var cel = row.insertCell(2);
                                    cel.innerHTML = "!";
                                    cel.style.color = "red";
                                    cel.id = com_counter +"two";
        
                                    var cel = row.insertCell(3);
                                    cel.innerHTML = "!";
                                    cel.style.color = "red";
                                    cel.id = com_counter +"three";
        
                                    var cel = row.insertCell(4);
                                    cel.innerHTML = "!";
                                    cel.style.color = "red";
                                    cel.id = com_counter +"four";
        
                                var url = '/report/retrieve_data_moh_report?year=' + year + "&indicator=" + indicator_values[i] + "&quarter=" + quarter;
                                jQuery.ajax({
                                            async: false,
                                            url: url,
                                            success: function(res){     
                                                var results = JSON.parse(res);
                                                console.log(indicator_values[i]);
                                                document.getElementById(com_counter+"one").innerHTML = results[0];
                                                document.getElementById(com_counter+"one").style.color = "maroon";
                                                document.getElementById(com_counter+"two").innerHTML = results[1];
                                                document.getElementById(com_counter+"two").style.color = "maroon";
                                                document.getElementById(com_counter+"three").innerHTML = results[2];
                                                document.getElementById(com_counter+"three").style.color = "maroon";
                                                document.getElementById(com_counter+"four").innerHTML = results[0] + results[1] + results[2];
                                                document.getElementById(com_counter+"four").style.color = "maroon";
                                                csv[com_counter] = [indicator_values[i],results[0],results[1],results[2],parseInt(results[0]) + parseInt(results[1]) + parseInt(results[2])];
                                                com_counter = com_counter + 1;
                                                progress_bar.style.width = (((com_counter - 1)/counter)*100).toFixed(0) +"%";
                                                progress_bar.style.background = "green";   
                                            },	
                                            error: function(err){
                                                alert("bad");
                                            }
                                });  
                                rows_counter = rows_counter + 1;                     
                            }
                            if (progress_bar.style.width == "100%")
                                {
                                    document.getElementById("export").style.display = "inline";
                                }
                            rows_header_counter = rows_header_counter + 1;
                            var department = depart;
                            row_counter = com_counter;                
                            com_counter = com_counter + 1;
                    }
                    else if (department == "Blood_Bank")
                    {
                            depart = "Blood Bank"
                            var row = rows.insertRow(row_counter);
                            var cel = row.insertCell(0);						
                            cel.innerHTML = depart.toUpperCase().bold();
                            cel.style.color = "darkblue";
                            cel.style.background = "lightgrey";
                            cel.colSpan = "5";
                            indicator_values = indicators[depart];
                            csv[com_counter - 1] = [depart,"","","",""];
                            counter = indicators[depart].length;
                           
                            var progress_bar = document.getElementById("head");
                            for (var i = 0; i < indicator_values.length; i++)
                            { 
                                                       
                                    var row = rows.insertRow(com_counter);
                                    var cel = row.insertCell(0);
                                    cel.innerHTML = indicator_values[i];
        
                                    var cel = row.insertCell(1);
                                    cel.innerHTML = "!";
                                    cel.style.color = "red";
                                    cel.id = com_counter +"one";
        
                                    var cel = row.insertCell(2);
                                    cel.innerHTML = "!";
                                    cel.style.color = "red";
                                    cel.id = com_counter +"two";
        
                                    var cel = row.insertCell(3);
                                    cel.innerHTML = "!";
                                    cel.style.color = "red";
                                    cel.id = com_counter +"three";
        
                                    var cel = row.insertCell(4);
                                    cel.innerHTML = "!";
                                    cel.style.color = "red";
                                    cel.id = com_counter +"four";
        
                                var url = '/report/retrieve_data_moh_report?year=' + year + "&indicator=" + indicator_values[i] + "&quarter=" + quarter;
                                jQuery.ajax({
                                            async: false,
                                            url: url,
                                            success: function(res){     
                                                var results = JSON.parse(res);
                                                     
                                                document.getElementById(com_counter+"one").innerHTML = results[0];
                                                document.getElementById(com_counter+"one").style.color = "maroon";
                                                document.getElementById(com_counter+"two").innerHTML = results[1];
                                                document.getElementById(com_counter+"two").style.color = "maroon";
                                                document.getElementById(com_counter+"three").innerHTML = results[2];
                                                document.getElementById(com_counter+"three").style.color = "maroon";
                                                document.getElementById(com_counter+"four").innerHTML = results[0] + results[1] + results[2];
                                                document.getElementById(com_counter+"four").style.color = "maroon";
                                                csv[com_counter] = [indicator_values[i],results[0],results[1],results[2],parseInt(results[0]) + parseInt(results[1]) + parseInt(results[2])];
                                                com_counter = com_counter + 1;
                                                progress_bar.style.width = (((com_counter - 1)/counter)*100).toFixed(0) +"%";
                                                progress_bar.style.background = "green";   
                                            },	
                                            error: function(err){
                                                alert("bad");
                                            }
                                });  
                                rows_counter = rows_counter + 1;                     
                            }
                            if (progress_bar.style.width == "100%")
                                {
                                    document.getElementById("export").style.display = "inline";
                                }
                            rows_header_counter = rows_header_counter + 1;
                            var department = depart;
                            row_counter = com_counter;                
                            com_counter = com_counter + 1;
                        
                    }
                    else if (department == "Biochemistry")
                    {
    
                    }
                    else if (department == "Parasitology")
                    {
    
                    }
                
                    
            }
            else if (level == "facility")
            {
                if (department == "Microbiology")
                {

                }
                else if (department == "Haematology")
                {

                }
                else if (department == "Serology")
                {

                }
                else if (department == "Blood_Bank")
                {

                }
                else if (department == "Biochemistry")
                {

                }
                else if (department == "Parasitology")
                {

                }

            }
            
        }





        function create_csv() {
            var months = [];
            var quarter = document.getElementById("quarter").value;
            if (quarter =="q1")
            {
                months[0] = ["JAN","FEB","MARCH"];
            }
            else if (quarter == "q2")
            {
                months[0] = ["APR","MAY","JUN"];
            }
            else if (quarter == "q3")
            {
                months[0] = ["JUL","AUG","SEP"];
            }
            else if (quarter == "q4")
            {
                months[0] = ["OCT","NOV","DEC"];
            }
           
            var final_csv ="Indicator" + "," + months[0][0] + "," + months[0][1] + "," + months[0][2] + ",TOTAL\n"
            var filename = "MoH_diagonistic_report_for_" + quarter + "_" + year  

            csv.forEach(function(row)
            {   final_csv += row.join(',');
                final_csv += "\n";
            });
            var link = document.createElement('a');
            if (typeof link.download === 'string')
            {   link.href = 'data:text/csv;charset=UTF-8,' + encodeURIComponent(final_csv);
                link.download = filename+".csv";
                document.body.appendChild(link);
                //simulate click
                link.click();
                //remove the link when done
                document.body.removeChild(link);
            } else 
            {window.open('data:text/csv;charset=UTF-8,' + encodeURIComponent(final_csv));
            }
        }
    </script>

</html>
